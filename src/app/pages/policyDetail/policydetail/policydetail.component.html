<app-layout>
  <div class="row m-3">
    <div class="container">
      <div class="col-md-12">
        <input class="form-control form-control-lg" type="search" [(ngModel)]="name"
          placeholder="Name,Mobile,policynumber" (keyup)="applyfilter($event.target.value)">
        <!-- <button class="btn btn-success" (click)="findinsured()">Search</button> -->
      </div>

      <div class="d-flex justify-content-between media mt-2">
        <div>
          <mat-form-field appearance="fill">
            <mat-label>Choose a date</mat-label>
            <input matInput [matDatepicker]="picker" (click)="picker.open()" datePickerFormat="YYYY/MM/DD" readonly
              (dateChange)="valueChanged(SelectedDate)" [(ngModel)]="SelectedDate" [max]="maxdate">
            <mat-hint>MM/DD/YYYY</mat-hint>
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
          </mat-form-field>
        </div>


        <div>
          <mat-form-field appearance="outline">
            <mat-label>Select Partner</mat-label>
            <mat-select [placeholder]="selectPartner" [(value)]="scode">
              <mat-option *ngFor="let userpart of insudata" [value]="userpart.id"
                (onSelectionChange)="filterprod(userpart.id,$event,'company')">
                {{userpart.shortName}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>


        <div>

          <mat-form-field appearance="outline">
            <mat-label>Select Product</mat-label>
            <mat-select [placeholder]="selectProduct" [(value)]="pcode">
              <mat-option *ngFor="let prod of selectpro"
                (onSelectionChange)="filterprod(prod.productcode,$event,'product')" [value]="prod.productcode">
                {{prod.productname}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div>
          <mat-form-field appearance="outline">
            <mat-label>Select User</mat-label>
            <mat-select [placeholder]="userdata" [(value)]="selected">
              <mat-option value="All" (click)="result()">All</mat-option>
              <mat-option *ngFor="let user of userdata" (onSelectionChange)="filterprod(user.id,$event,'userid')"
                [value]="user.id">
                {{user.firstName}}
              </mat-option>
            </mat-select>

          </mat-form-field>

        </div>


        <div>
          <button class="button mt-2" (click)="filterreq()">Search</button>
        </div>
      </div>
    </div>
  </div>



  <div class="mat-elevation-z8 ">
    <table mat-table [dataSource]="dataSource" class=" table table-striped">

      <!-- Position Column -->
      <ng-container matColumnDef="name">
        <th mat-header-cell mat-sort-header *matHeaderCellDef class="mat-header-cell">Member Name </th>
        <td mat-cell class=" mat-cell" *matCellDef="let element"> {{element.membername}} </td>
      </ng-container>



      <!-- Weight Column -->
      <ng-container matColumnDef="DOB">
        <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> DOB </th>
        <td mat-cell class=" mat-celldob" *matCellDef="let element"> {{element.memberdob | date:'dd-MM-yyyy'}} </td>
      </ng-container>

      <!-- Symbol Column -->
      <ng-container matColumnDef="mobile">
        <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Mobile </th>
        <td mat-cell class=" mat-cell" *matCellDef="let element"> {{element.membermobile}} </td>
      </ng-container>

      <ng-container matColumnDef="relation">
        <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Insured Relation </th>
        <td mat-cell class=" mat-cell" *matCellDef="let element">
          {{relationshipMap.get(element.memberrelationfromprimary)}} </td>
      </ng-container>

      <ng-container matColumnDef="createdat">
        <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Create date </th>
        <td mat-cell class=" mat-cell" *matCellDef="let element"> {{element.createdat | date:'dd-MM-yyyy'}} </td>
      </ng-container>


      <ng-container matColumnDef="Receipt">
        <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Receipt </th>

        <td *matCellDef="let element">

          <div class='row' [ngSwitch]="element.payment_response">
            <div *ngSwitchCase="'C'">
              <i class="fa fa-credit-card" (click)="receipt(element.proposalid)"
                style="font-size:24px;color: #2da44a; cursor: pointer;"></i>
            </div>
            <div *ngSwitchCase="'I'"> Initiated</div>
            <div *ngSwitchCase="'F'"> Failed</div>
            <div *ngSwitchDefault>Incomplete</div>
          </div>



        </td>

      </ng-container>
      <!-- <ng-container matColumnDef="Receipt">
        <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Receipt </th>

        <td *matCellDef="let element" (click)="receipt(element.proposalid)">
          <i class="fa fa-credit-card" style="font-size:24px;color: #2da44a; cursor: pointer;"
            *ngIf="element.proposalid!=null"></i>
        </td>

      </ng-container> -->


      <ng-container matColumnDef="Download">
        <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Download </th>
        <td *matCellDef="let element">

          <div class='row' [ngSwitch]="element.payment_response">
            <div *ngSwitchCase="'C'">
              <i class="fa fa-download" style="font-size:24px;color: #2c3b97;cursor: pointer;"
                (click)="download(element.proposalid)"></i>
            </div>
            <div *ngSwitchCase="'I'">
              Initiated
            </div>
            <div *ngSwitchCase="'F'">
              Failed
            </div>
            <div *ngSwitchDefault>
              Incomplete
            </div>
          </div>




        </td>
      </ng-container>
      <!-- ghc certificate -->
      <ng-container matColumnDef="ghc">
        <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> GHC Certificate </th>
        <td *matCellDef="let element">

          <div class='row' [ngSwitch]="element.payment_response">
            <div *ngSwitchCase="'C'">
              <i class="fa fa-download" style="font-size:24px;color: #2c3b97;cursor: pointer;"
                (click)="ghcdoc(element.proposalid)"></i>
            </div>
            <div *ngSwitchCase="'I'">
              Initiated
            </div>
            <div *ngSwitchCase="'F'">
              Failed
            </div>
            <div *ngSwitchDefault>
              Incomplete
            </div>
          </div>
        </td>
      </ng-container>
      <!-- gpa certificate -->
      <ng-container matColumnDef="gpa">
        <th mat-header-cell *matHeaderCellDef class="mat-header-cell">GPA Certificate </th>
        <td *matCellDef="let element" >

          <div class='row' [ngSwitch]="element.payment_response" >
            <div *ngSwitchCase="'C'">
              <i class="fa fa-download" style="font-size:24px;color: #2c3b97;cursor: pointer;"
                (click)="gpadoc(element.proposalid)"></i>
            </div>
            <div *ngSwitchCase="'I'">
              Initiated
            </div>
            <div *ngSwitchCase="'F'">
              Failed
            </div>
            <div *ngSwitchDefault>
              Incomplete
            </div>
          </div>
        </td>
      </ng-container>


      <ng-container class="col-md-1" matColumnDef="insured">
        <th mat-header-cell *matHeaderCellDef> Insured Detail</th>
        <td mat-cell *matCellDef="let element" (click)="openDialog(element.coiInsured)"><button
            style="border-radius: 5px;">
            <i class="fa fa-info " style="font-size:24px;border-radius:8px; color: #2da44a;"></i></button></td>
      </ng-container>

      <ng-container class="col-md-1" matColumnDef="pay">
        <th mat-header-cell *matHeaderCellDef> Payment</th>
        <td mat-cell *matCellDef="let element">

          <div class='row' [ngSwitch]="element.payment_response">

            <div *ngSwitchCase="'C'">
              Completed
            </div>
            <div *ngSwitchCase="'I'">
              <div *ngIf="productdata?.length!=0">
                <button class="btnc" (click)="paylink(element.proposalid)" style="border-radius: 5px;">Pay
                </button>
              </div>
              <div *ngIf="productdata?.length==0">
                Initiated
              </div>
            </div>
            <div *ngSwitchCase="'F'">
              <div *ngIf="productdata?.length!=0">
                <button class="btnc" (click)="paylink(element.proposalid)" style="border-radius: 5px;">Pay
                </button>
              </div>
              <div *ngIf="productdata?.length==0">
                Failed
              </div>
            </div>
            <div *ngSwitchDefault>
              <div *ngIf="productdata?.length!=0">
                <button class="btnc" (click)="paylink(element.proposalid)" style="border-radius: 5px;">Pay
                </button>
              </div>
              <div *ngIf="productdata?.length==0">
                Incomplete
              </div>
            </div>
          </div>


        </td>
      </ng-container>

      <ng-container matColumnDef="concent">
        <th mat-header-cell *matHeaderCellDef class="mat-header-cell"> Consent </th>
        <td mat-cell class=" mat-cell" *matCellDef="let element"> {{element.otp_consent_time | date: 'dd/MM/yyyy'}}
        </td>
      </ng-container>
      
      <ng-container class="col-md-1" matColumnDef="edit" >
        <th mat-header-cell *matHeaderCellDef> Edit </th>
        <td mat-cell *matCellDef="let element" (click)="editform(element.proposalid)"><button
            style="border-radius: 5px;" *ngIf="element.payment_response!='C' && productdata?.length!=0">
            <i class="fa fa-edit " style="font-size:24px;border-radius:8px; color: #2da44a;"></i></button></td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <mat-paginator #paginator [pageSizeOptions]="[5, 10, 20,50,70,100]" showFirstLastButtons
      aria-label="Select page of periodic elements">
    </mat-paginator>
  </div>

</app-layout>